setwd("c:/Users/정은/Desktop/new_bigdata_set/Final Total Data")
DF <- read.csv("Sleeping princess in penguin room.csv")
life <- DF[[3]]
gdp <- DF[[4]]; sani <- DF[[5]]; pre <- DF[[6]]; pri <- DF[[7]]
sec <- DF[[8]]; ter <- DF[[9]]; smo <- DF[[11]]; ob <- DF[[12]]
al <- DF[[13]]; co2 <- DF[[14]]; hiv <- DF[[15]]
n <- nrow(DF); p <- ncol(DF) - 4
View(DF)
reg <- lm(life~gdp+sani+pre+pri+sec+ter+smo+ob+al+co2+hiv)
r <- reg$residuals
mse <- t(r) %*% r / (n - p - 1)
e <- r/c(sqrt(mse))
par(mfrow = c(1,1))
qqnorm(e)
abline(0, 1, col=2)
alpha <- 0.05
temp <- (n - p - 2)/ (n - p - 1 - r^2)
t <- r * sqrt(abs(temp)) * sign(temp)
out.id <- which(abs(t) > qt(1-alpha/2, n - p - 2)); out.id
temp[temp<=0]
t1 <- r * sqrt(temp)
identical(t1,t)
abs(t) > qt(1-alpha/2, n - p - 2)
qt(0.975, n-p-2)
which(abs(t) > qt(1-alpha/2, n - p - 2))
y.hat <- reg$fitted.values
plot(e, type = "n", xlab = "index", ylab = "residual", main="studentized residual")
text(e, cex = 0.7)
text(out.id, e[out.id], out.id, col=2, cex = 0.7)
abline(h = 0, col = 2, lty = 2)
points(out.id, e[out.id], col = 4, cex = 2)
abs(t) > qt(1-alpha/2, n - p - 2)
qt(1-alpha/2, n - p - 2)
y.hat <- reg$fitted.values
plot(t, type = "n", xlab = "index", ylab = "residual", main="studentized residual")
text(t, cex = 0.7)
text(out.id, e[out.id], out.id, col=2, cex = 0.7)
plot(e, type = "n", xlab = "index", ylab = "residual", main="studentized residual")
text(e, cex = 0.7)
text(out.id, e[out.id], out.id, col=2, cex = 0.7)
abline(h = 0, col = 2, lty = 2)
points(out.id, e[out.id], col = 4, cex = 2)
t
round(t,4)
plot(t)
abline(h = c(qt(1-alpha/2, n - p - 2, -qt(1-alpha/2, n - p - 2)), col = 2)
#1.5 IQR
summary(y.hat)
IQR <- quantile(r, prob = 0.75) - quantile(r, prob = 0.25)
lower.bound <- quantile(r, prob = 0.25) - 1.5*IQR
upper.bound <- quantile(r, prob = 0.75) + 1.5*IQR
#out.shit <- which(r >= quantile(r, prob = 0.975) | r <= quantile(r, prob = 0.025))
out.IQR <- which(r <= lower.bound | r >= upper.bound)
#plot IQR
y.hat <- reg$fitted.values
plot(r, type = "n", xlab = "index", ylab = "residual", main = "1.5 IQR outlier")
text(r, cex = 0.7)
text(out.IQR, r[out.IQR], out.IQR, col=2, cex = 0.7)
abline(h = 0, col = 2, lty = 2)
points(out.IQR, r[out.IQR], col = 4, cex = 3)
## 22, 58, 106
#box plot
boxplot(r, main = "residual box plot", horizontal = T)
#####influential point#####
#Cook's distance
X1 <- as.matrix(DF[,-c(1, 2, 3, 10)])
X1[,1] <- X1[,1]/(10^9)  #gdp 너무 커서 R이 못견뎌요. 근데 double로 형변환하기는 싫어요.
X <- cbind(rep(1, n), X1)
H <- X %*% solve(t(X) %*% X) %*% t(X)
h <- diag(H)
C <- ((r^2)/(p+1)) * (h/(1-h))
infl.id <- names(C)[C > 1]
plot(C, type = "n", main = "Cook's distance, influential point")
text(C, cex = 0.7)
abline(h = 1, col = 2, lty = 2)
points(infl.id, C[infl.id], col = 4, cex = 3)
## 44, 106, 145
#DFFITS
DFFITS <- t * sqrt(h / (1 - h))
plot(DFFITS, ylim = c(-0.5, 3.5), type = "n", main = "DFFITS, influential points")
text(abs(DFFITS), cex = 0.7)
abline(h = 2 * sqrt((p + 1)/(n - p - 1)), col = 2, lty = 2)
#파탄~ 우리는 쿡이 좋아요~ / studentized t가 파탄나서 DFFITS도 파탄 잼
#############################################
################assumption test##################
##############influential point delete fitted model ################
infl.id # 44, 106, 145
DF.1 <- DF[-as.numeric(infl.id),]
life.1 <- DF.1[[3]]
gdp.1 <- DF.1[[4]]; sani.1 <- DF.1[[5]]; pre.1 <- DF.1[[6]]; pri.1 <- DF.1[[7]]
sec.1 <- DF.1[[8]]; ter.1 <- DF.1[[9]]; smo.1 <- DF.1[[11]]; ob.1 <- DF.1[[12]]
al.1 <- DF.1[[13]]; co2.1 <- DF.1[[14]]; hiv.1 <- DF.1[[15]]
n.1 <- nrow(DF.1); p <- ncol(DF.1) - 4
reg.1 <- lm(life.1~gdp.1+sani.1+pre.1+pri.1+sec.1+ter.1+smo.1+ob.1+al.1+co2.1+hiv.1)
obj <- summary(reg.1)
names(obj)
round(obj$coefficients, 4)
###########################로그변환########################
log.gdp <- log(gdp.1, 10); log.co2 <- log(co2.1, 2); log.hiv <- log(hiv.1, 2)
reg.log <- lm(life.1~log.gdp+sani.1+pre.1+pri.1+sec.1+ter.1+smo.1+ob.1+al.1+log.co2+log.hiv)
obj.log <- summary(reg.log)
round(obj.log$coefficients, 4)
abline(h = c(qt(1-alpha/2, n - p - 2, -qt(1-alpha/2, n - p - 2))), col = 2)
abline(h = c(qt(1-alpha/2, n - p - 2, -qt(1-alpha/2, n - p - 2))), col = 2)
plot(t)
abline(h = c(qt(1-alpha/2, n - p - 2, -qt(1-alpha/2, n - p - 2))), col = 2)
abline(h = c(qt(1-alpha/2, n - p - 2), -qt(1-alpha/2, n - p - 2)), col = 2)
plot(t)
abline(h = c(qt(1-alpha/2, n - p - 2), -qt(1-alpha/2, n - p - 2)), col = 2)
rm(list=ls())
setwd("c:/Users/정은/Desktop/new_bigdata_set/Final Total Data")
DF <- read.csv("Sleeping princess in penguin room.csv")
life <- DF[[3]]
gdp <- DF[[4]]; sani <- DF[[5]]; pre <- DF[[6]]; pri <- DF[[7]]
sec <- DF[[8]]; ter <- DF[[9]]; smo <- DF[[11]]; ob <- DF[[12]]
al <- DF[[13]]; co2 <- DF[[14]]; hiv <- DF[[15]]
n <- nrow(DF); p <- ncol(DF) - 4
log.gdp <- log(gdp.1, 10); log.co2 <- log(co2.1, 2); log.hiv <- log(hiv.1, 2)
reg.log <- lm(life.1~log.gdp+sani.1+pre.1+pri.1+sec.1+ter.1+smo.1+ob.1+al.1+log.co2+log.hiv)
DF.1 <- DF[-as.numeric(infl.id),]
life.1 <- DF.1[[3]]
gdp.1 <- DF.1[[4]]; sani.1 <- DF.1[[5]]; pre.1 <- DF.1[[6]]; pri.1 <- DF.1[[7]]
sec.1 <- DF.1[[8]]; ter.1 <- DF.1[[9]]; smo.1 <- DF.1[[11]]; ob.1 <- DF.1[[12]]
al.1 <- DF.1[[13]]; co2.1 <- DF.1[[14]]; hiv.1 <- DF.1[[15]]
DF.1 <- DF[-as.numeric(infl.id),]
infl.id <- c(44, 106, 145) # 44, 106, 145
DF.1 <- DF[-as.numeric(infl.id),]
life.1 <- DF.1[[3]]
gdp.1 <- DF.1[[4]]; sani.1 <- DF.1[[5]]; pre.1 <- DF.1[[6]]; pri.1 <- DF.1[[7]]
sec.1 <- DF.1[[8]]; ter.1 <- DF.1[[9]]; smo.1 <- DF.1[[11]]; ob.1 <- DF.1[[12]]
al.1 <- DF.1[[13]]; co2.1 <- DF.1[[14]]; hiv.1 <- DF.1[[15]]
log.gdp <- log(gdp.1, 10); log.co2 <- log(co2.1, 2); log.hiv <- log(hiv.1, 2)
reg.log <- lm(life.1~log.gdp+sani.1+pre.1+pri.1+sec.1+ter.1+smo.1+ob.1+al.1+log.co2+log.hiv)
par(mfrow=c(2,2))
plot(reg.log)
plot(reg.log)
plot(reg.log)[2,2]
plot(reg.log)[4]
plot(reg.log)
par(mfrow=c(1,2))
plot(reg.log)
par(mfrow=c(1,2))
plot(reg.log)
plot(reg)
reg <- lm(life~gdp+sani+pre+pri+sec+ter+smo+ob+al+co2+hiv)
plot(reg)
plot(reg.1)
reg.1 <- lm(life.1~gdp.1+sani.1+pre.1+pri.1+sec.1+ter.1+smo.1+ob.1+al.1+co2.1+hiv.1)
plot(reg.1)
plot(reg)
plot(reg.1)
